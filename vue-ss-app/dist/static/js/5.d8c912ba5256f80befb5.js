webpackJsonp([5],{RNnh:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__=__webpack_require__("//Fk"),__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise__),__WEBPACK_IMPORTED_MODULE_2__components_Utils_Store__=__webpack_require__("F3vo"),__WEBPACK_IMPORTED_MODULE_3_vant__=__webpack_require__("Fd2+");__webpack_exports__.a={name:"MaterialApply",components:{FieldPickerSingle:function(){return __webpack_require__.e(10).then(__webpack_require__.bind(null,"QkLz"))},VanButton:__WEBPACK_IMPORTED_MODULE_3_vant__.a,VanTabbar:__WEBPACK_IMPORTED_MODULE_3_vant__.s,VanTabbarItem:__WEBPACK_IMPORTED_MODULE_3_vant__.t,VanCollapse:__WEBPACK_IMPORTED_MODULE_3_vant__.g,VanCollapseItem:__WEBPACK_IMPORTED_MODULE_3_vant__.h,VanField:__WEBPACK_IMPORTED_MODULE_3_vant__.j,VanPopup:__WEBPACK_IMPORTED_MODULE_3_vant__.p,VanCol:__WEBPACK_IMPORTED_MODULE_3_vant__.f,VanRow:__WEBPACK_IMPORTED_MODULE_3_vant__.q,VanIcon:__WEBPACK_IMPORTED_MODULE_3_vant__.k},data:function(){return{active:"",activeNames:[0],mdata:{kfbh:"",kfbhid:0,djlb:"",djlbid:0,xmjl:"",xmjlid:0,fgid:0,bm:"",bmid:0,xl:"",xldm:"",xlid:0,detail:[]},loading:!1,scanVisible:!0}},methods:{init:function(){llApp.init()},pickerSingleBack:function(t,e,i){"getMaterialApplyXmjl"==t?this.mdata.fgid=i.fgid:"getDesignStyleList"==t&&(this.mdata.xlid=i.id)},handleSelect:function(t){"add"==t?this.scan():"save"==t?this.save():"clear"==t&&this.clear()},search:function(t){var e=this;this.loading=!0,this.searchPromise(t).then(function(t){if(0!=t.errcode)return e.errMsg(t.errmsg),void(e.loading=!1);for(var i={},a=t.data[0][0],n=0;n<e.mdata.detail.length;n++){if(e.mdata.detail[n].khid!=a.khid)return e.errMsg("供应商不一致"),void(e.loading=!1);if(e.mdata.detail[n].chmc==a.mlbh)return e.errMsg("此材料已经扫描"),void(e.loading=!1)}i.chdm=a.llyphh,i.chmc=a.mlbh,i.khid=a.khid,i.khmc=a.sydw,i.lymxid=a.lymxid,i.id=a.id,i.zks=0,i.kfbhdm=a.kfbhdm,e.mdata.detail.unshift(i),e.loading=!1,e.active=""}).catch(function(t){e.errmsg(t),e.loading=!1,e.active=""})},searchPromise:function(t){var e=this;return new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function(i,a){e.$axios.get(APIUTL,{params:{action:"getMaterialApplyList",chdm:t}}).then(function(t){i(t.data)}).catch(function(t){a(t)})})},scan:function(){var t=this;llApp.scanQRCode(function(e){t.active="";var i="";if("chdm"!=e.split(":")[0])return t.errMsg("标签不对"),!1;i=e.split(":")[1],t.search(i)})},clear:function(){this.mdata.detail=[]},itemRemove:function(t){this.mdata.detail.splice(this.mdata.detail.indexOf(t),1)},save:function save(){var _this4=this,dataObj={};dataObj.dataList=new Array,dataObj.kfbh=this.mdata.kfbhid;var zbObj={},mxObj=[];if(zbObj.kfbhid=this.mdata.kfbhid,zbObj.xlid=this.mdata.xlid,zbObj.cname=__WEBPACK_IMPORTED_MODULE_2__components_Utils_Store__.a.userInfo.cname,zbObj.xmjl=this.mdata.xmjl,zbObj.bmid=this.mdata.bmid,zbObj.djlbid=this.mdata.djlbid,0==this.mdata.djlbid)return this.errMsg("请选择采购类别"),void(this.active="");if(0==this.mdata.kfbhid)return this.errMsg("开发编号一定要填写"),void(this.active="");if(0==this.mdata.detail.length)return this.errMsg("没有材料"),void(this.active="");var xmjl="";if(8563==this.mdata.bmid||8639==this.mdata.bmid){if(0==this.mdata.xmjl.length)return this.errMsg("请先填写项目经理"),void(this.active="")}else xmjl=this.mdata.xmjl||__WEBPACK_IMPORTED_MODULE_2__components_Utils_Store__.a.userInfo.cname;if(16902!=this.mdata.xlid&&16679!=this.mdata.xlid&&8985!=this.mdata.xlid&&8984!=this.mdata.xlid&&(8563==this.mdata.bmid||8639==this.mdata.bmid)&&this.mdata.fgid!=this.mdata.xlid)return this.errMsg("成衣设计风格选择有误"),this.active="",!1;for(var khid=0,isFL=!1,i=0;i<this.mdata.detail.length;i++){var mxTemp={};if(khid=khid||this.mdata.detail[i].khid,khid!=this.mdata.detail[i].khid)return this.errMsg("选择的供应商必须一致"),this.active="",!1;zbObj.khid=khid,mxTemp.id=this.mdata.detail[i].id,mxTemp.kfbhdm=this.mdata.detail[i].kfbhdm,mxTemp.lymxid=this.mdata.detail[i].lymxid,mxTemp.wgbsid=this.mdata.detail[i].wgbsid,mxTemp.htidid=this.mdata.detail[i].htidid,mxTemp.sl=this.mdata.detail[i].sl,mxTemp.chdm=this.mdata.detail[i].chdm,mxTemp.chmc=this.mdata.detail[i].chmc,mxTemp.zks=this.mdata.detail[i].zks;var sphhObj={};if(sphhObj.chdm=this.mdata.detail[i].chdm,dataObj.dataList.push(sphhObj),!this.mdata.detail[i].zks&&7748==this.mdata.djlbid)return this.errMsg("请正确填写标签数量"),this.active="",!1;if(!this.mdata.detail[i].sl)return this.errMsg("请正确填写数量"),this.active="",!1;if(console.log(this.mdata.detail[i].wgbsid),!this.mdata.detail[i].wgbsid)return this.errMsg("请选择好品类"),this.active="",!1;isFL=isFL||9114!=this.mdata.detail[i].lymxid,mxObj.push(mxTemp)}if(isFL&&7748==this.mdata.djlbid)return this.errMsg("辅料的采购类别不能选择[面料申购]"),this.active="",!1;this.lbCheckPromise(dataObj).then(function(result){if(console.log(result),"ok"==result.data)_this4.savePromise(zbObj,mxObj).then(function(t){0==t.errcode?(_this4.$message("保存成功"),_this4.clear()):_this4.errMsg(t.errmsg),_this4.active=""}).catch(function(t){_this4.active=""});else{var r=eval("("+result+")"),errorList=new Array;for(var o in r.msg)errorList.push("大类:"+r.msg[o].wllb+"材料:"+r.msg[o].chdm+"\r\n");_this4.errMsg("下列材料不在方案内:"+errorList.join(",")+"\r\n请联系商控部."),_this4.active=""}}).catch(function(t){console.log(t),_this4.active=""})},savePromise:function(t,e){var i=this;return new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function(a,n){i.$axiosPost.post(APIUTL+"?action=SaveMaterialApply",[t,e]).then(function(t){a(t.data)}).catch(function(t){n(t)})})},lbCheckPromise:function(t){var e=this;return new __WEBPACK_IMPORTED_MODULE_1_babel_runtime_core_js_promise___default.a(function(i,a){var n=new URLSearchParams;n.append("from",__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(t)),e.$axios.post(APIUTL+"?serviceGotoUrl="+NetUrlUpload+"tl_yf/yf_sys_ajax_handle.ashx&from=BID.3695&tag=check&serviceGoto=.net&encoding=gb2312&userssid=1&userid="+__WEBPACK_IMPORTED_MODULE_2__components_Utils_Store__.a.userInfo.userid,n).then(function(t){i(t)}).catch(function(t){a(t)})})},errMsg:function(t){this.$message({showClose:!0,message:t,type:"error"})}},mounted:function(){},watch:{},computed:{},created:function(){this.init()}}},"gR+z":function(t,e,i){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var a=i("RNnh"),n={render:function(){var t=this,e=t.$createElement,i=t._self._c||e;return i("div",{staticClass:"wrap"},[i("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"},{name:"show",rawName:"v-show",value:t.scanVisible,expression:"scanVisible"}],staticStyle:{"margin-left":"10px","margin-right":"10px","margin-top":"10px"}},[i("van-cell-group",[i("FieldPickerSingle",{attrs:{title:"开发编号",inValue:t.mdata.kfbhid,inText:t.mdata.kfbh,type:"getDevNumList"},on:{"update:inValue":function(e){return t.$set(t.mdata,"kfbhid",e)},"update:in-value":function(e){return t.$set(t.mdata,"kfbhid",e)},"update:inText":function(e){return t.$set(t.mdata,"kfbh",e)},"update:in-text":function(e){return t.$set(t.mdata,"kfbh",e)}}}),t._v(" "),i("FieldPickerSingle",{attrs:{title:"采购类别",inValue:t.mdata.djlbid,inText:t.mdata.djlb,type:"getMaterialApplyDjlb"},on:{"update:inValue":function(e){return t.$set(t.mdata,"djlbid",e)},"update:in-value":function(e){return t.$set(t.mdata,"djlbid",e)},"update:inText":function(e){return t.$set(t.mdata,"djlb",e)},"update:in-text":function(e){return t.$set(t.mdata,"djlb",e)}}}),t._v(" "),i("FieldPickerSingle",{attrs:{title:"申请部门",inValue:t.mdata.bmid,inText:t.mdata.bm,type:"getMaterialApplyBm"},on:{"update:inValue":function(e){return t.$set(t.mdata,"bmid",e)},"update:in-value":function(e){return t.$set(t.mdata,"bmid",e)},"update:inText":function(e){return t.$set(t.mdata,"bm",e)},"update:in-text":function(e){return t.$set(t.mdata,"bm",e)}}}),t._v(" "),i("FieldPickerSingle",{attrs:{title:"设计风格",inValue:t.mdata.xldm,inText:t.mdata.xl,type:"getDesignStyleList"},on:{"update:inValue":function(e){return t.$set(t.mdata,"xldm",e)},"update:in-value":function(e){return t.$set(t.mdata,"xldm",e)},"update:inText":function(e){return t.$set(t.mdata,"xl",e)},"update:in-text":function(e){return t.$set(t.mdata,"xl",e)},goback:t.pickerSingleBack}}),t._v(" "),i("FieldPickerSingle",{attrs:{title:"项目经理",inValue:t.mdata.xmjlid,inText:t.mdata.xmjl,type:"getMaterialApplyXmjl"},on:{"update:inValue":function(e){return t.$set(t.mdata,"xmjlid",e)},"update:in-value":function(e){return t.$set(t.mdata,"xmjlid",e)},"update:inText":function(e){return t.$set(t.mdata,"xmjl",e)},"update:in-text":function(e){return t.$set(t.mdata,"xmjl",e)},goback:t.pickerSingleBack}})],1),t._v(" "),i("van-collapse",{model:{value:t.activeNames,callback:function(e){t.activeNames=e},expression:"activeNames"}},t._l(t.mdata.detail,function(e,a){return i("van-collapse-item",{key:a,attrs:{name:a},scopedSlots:t._u([{key:"title",fn:function(){return[i("van-row",[i("van-col",{attrs:{span:"20"}},[i("div",[t._v("\n                材料编号:"+t._s(e.chdm)+" 材料名称:"+t._s(e.chmc)+"\n              ")])]),t._v(" "),i("van-col",{attrs:{span:"4"}},[i("van-button",{attrs:{icon:"delete",type:"danger"},on:{click:function(i){return t.itemRemove(e)}}})],1)],1)]},proxy:!0}],null,!0)},[t._v(" "),i("div",[i("van-cell-group",[i("div",[t._v(t._s(e.khmc))]),t._v(" "),i("van-field",{attrs:{type:"number",label:"调样数量"},model:{value:e.sl,callback:function(i){t.$set(e,"sl",i)},expression:"item.sl"}}),t._v(" "),i("FieldPickerSingle",{attrs:{title:"品类",inValue:e.wgbsid,inText:e.wgbs,type:"getClothTypes",inExtObj:{query:"yfdy"}},on:{"update:inValue":function(i){return t.$set(e,"wgbsid",i)},"update:in-value":function(i){return t.$set(e,"wgbsid",i)},"update:inText":function(i){return t.$set(e,"wgbs",i)},"update:in-text":function(i){return t.$set(e,"wgbs",i)}}}),t._v(" "),i("FieldPickerSingle",{attrs:{title:"颜色情况",inValue:e.htidid,inText:e.htid,type:"getMaterialApplyTypes"},on:{"update:inValue":function(i){return t.$set(e,"htidid",i)},"update:in-value":function(i){return t.$set(e,"htidid",i)},"update:inText":function(i){return t.$set(e,"htid",i)},"update:in-text":function(i){return t.$set(e,"htid",i)}}}),t._v(" "),i("van-field",{attrs:{type:"digit",label:"标签数"},model:{value:e.zks,callback:function(i){t.$set(e,"zks",i)},expression:"item.zks"}})],1)],1)])}),1)],1),t._v(" "),i("van-tabbar",{on:{change:t.handleSelect},model:{value:t.active,callback:function(e){t.active=e},expression:"active"}},[i("van-tabbar-item",{attrs:{name:"add",icon:"scan"}},[t._v("添加")]),t._v(" "),i("van-tabbar-item",{attrs:{name:"save",icon:"certificate"}},[t._v("保存")]),t._v(" "),i("van-tabbar-item",{attrs:{name:"clear",icon:"replay"}},[t._v("清空")])],1)],1)},staticRenderFns:[]};var _=function(t){i("wR8a")},s=i("VU/8")(a.a,n,!1,_,"data-v-75eaf44a",null);e.default=s.exports},wR8a:function(t,e){}});
//# sourceMappingURL=5.d8c912ba5256f80befb5.js.map