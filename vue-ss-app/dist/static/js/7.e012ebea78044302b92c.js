webpackJsonp([7],{"js/c":function(a,t){},vKe9:function(a,t,e){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=e("//Fk"),n=e.n(s),l=e("F3vo"),i=e("Fd2+"),r={name:"MaterielCode",components:{FieldPickerSingle:function(){return e.e(10).then(e.bind(null,"QkLz"))},PickerSingle:function(){return e.e(0).then(e.bind(null,"1bf3"))},PopupRowCol:function(){return e.e(11).then(e.bind(null,"cOc4"))},VanButton:i.a,VanTabbar:i.s,VanTabbarItem:i.t,VanCollapse:i.g,VanCollapseItem:i.h,VanField:i.j,VanPopup:i.p,VanCol:i.f,VanRow:i.q,VanIcon:i.k,VanDivider:i.i,VanNavBar:i.m,VanNoticeBar:i.n,VanCheckbox:i.e,VanLoading:i.l,VanToast:i.u,VanSwitch:i.r},data:function(){return{active:"",saveErr:"",activeNames:[0],allChoose:!1,search:{isml:!0,filterModel:!0,ksrq:"",jsrq:"",ghsmc:"",chdm:"",mlbh:"",showCalendarStar:!1,showCalendarEnd:!1,kfbh:"",myck:2,shbs:!1},mdata:{list:[]},userid:l.a.userInfo.userid,cname:l.a.userInfo.cname,errmsg:""}},methods:{init:function(){},onCalendarStarConfirm:function(a){this.search.ksrq=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),this.search.showCalendarStar=!1},onCalendarEndConfirm:function(a){this.search.jsrq=a.getFullYear()+"-"+(a.getMonth()+1)+"-"+a.getDate(),this.search.showCalendarEnd=!1},handleSelect:function(a){"save"==a&&this.save(),"choose"==a&&(this.allChooseFun(),this.active=""),"search"==a&&(this.search.filterModel=!0,this.active="")},allChooseFun:function(){if(this.allChoose){this.allChoose=!1;for(var a=0;a<this.mdata.list.length;a++)this.mdata.list[a].choose=!1}else{this.allChoose=!0;for(a=0;a<this.mdata.list.length;a++)this.search.isml?""!=this.mdata.list[a].btx||(this.mdata.list[a].choose=!0):this.mdata.list[a].chdmbs.length>0||0==this.mdata.list[a].llyphh.length||(this.mdata.list[a].choose=!0)}},itemClick:function(a){a.choose=!a.choose},mlswitch:function(){this.mdata.list.splice(0,this.mdata.list.length)},searchFun:function(){var a=this;if(0==this.search.ksrq.length&&0==this.search.jsrq.length&&0==this.search.chdm.length&&0==this.search.ghsmc.length&&0==this.search.kfbh.length&&0==this.search.mlbh.length)return this.errmsg="请选择条件",!1;this.search.filterModel=!1,i.u.loading({duration:0,message:"加载中...",forbidClick:!0}),this.allChoose=!1,this.searchPromise().then(function(t){if(0==t.errcode){for(var e=t.data[0],s=0;s<e.length;s++)null==e[s].btx&&(e[s].btx=""),null==e[s].tpname&&(e[s].tpname=""),null!=e[s].hsbl&&0!=e[s].hsbl||(e[s].hsbl=""),e[s].choose=!1;a.mdata.list=e.slice(0,100),i.u.clear()}else i.u.fail(t.errmsg)}).catch(function(a){i.u.fail(a)})},searchPromise:function(){var a=this,t={};return t.ksrq=this.search.ksrq,t.jsrq=this.search.jsrq,t.mlbh=this.search.mlbh,t.chdm=this.search.chdm,t.myck=this.search.myck,t.shbs=this.search.shbs?1:0,t.ghsmc=this.search.ghsmc,t.kfbh=this.search.kfbh,t.isml=this.search.isml,new n.a(function(e,s){a.$axiosPost.post(APIUTL+"?serviceName=svr-financia-management&action=MaterielCode",t).then(function(a){e(a.data)}).catch(function(a){s(a)})})},save:function(){var a=this,t={data:[]};if(this.saveErr="",this.search.isml){for(var e=[],s=[],n=[],r=[],h=0;h<this.mdata.list.length;h++)0!=this.mdata.list[h].choose&&(t.data.push(this.mdata.list[h]),this.mdata.list[h].xjchlbid||e.push(this.mdata.list[h].mlbhmc2),this.mdata.list[h].hsbl||s.push(this.mdata.list[h].mlbhmc2),this.mdata.list[h].sjchlbid||n.push(this.mdata.list[h].mlbhmc2),this.mdata.list[h].ysid||r.push(this.mdata.list[h].mlbhmc2));if(e.length>0||s.length>0||n.length>0||r.length>0)return this.active="",e.length>0&&(this.saveErr+="大小类有问题:"+e.join(",")),s.length>0&&(this.saveErr+="换算比例有问题:"+s.join(",")),n.length>0&&(this.saveErr+="大类有问题:"+n.join(",")),r.length>0&&(this.saveErr+="颜色有问题:"+r.join(",")),!1}else{var c=[],o=[],m=[],d=[];for(h=0;h<this.mdata.list.length;h++)0!=this.mdata.list[h].choose&&(t.data.push(this.mdata.list[h]),0!=Number(this.mdata.list[h].shbl)&&c.push(this.mdata.list[h].mlbh),this.mdata.list[h].hsbl||o.push(this.mdata.list[h].mlbh),0==Number(this.mdata.list[h].sjchlbid)&&m.push(this.mdata.list[h].mlbh),this.mdata.list[h].ysid||d.push(this.mdata.list[h].mlbh));if(c.length>0||o.length>0||m.length>0||d.length>0)return this.active="",c.length>0&&(this.saveErr+="损耗比例有问题:"+c.join(",")),o.length>0&&(this.saveErr+="换算比例有问题:"+o.join(",")),m.length>0&&(this.saveErr+="大类有问题:"+m.join(",")),d.length>0&&(this.saveErr+="颜色有问题:"+d.join(",")),!1}t.userssid=1,t.username=l.a.userInfo.cname,t.userid=this.userid,t.isml=this.search.isml,i.u.loading({duration:0,message:"加载中...",forbidClick:!0}),this.savePromise(t).then(function(t){if(0==t.errcode){for(var e=[],s=[],n=0;n<t.data.length;n++){var l=t.data[n];0==l.errcode?e.push(l.data.llyphh):s.push(l.data.llyphh)}a.saveErr=(e.length>0?"成功"+e.join(","):"")+(s.length>0?"失败:"+s.join(","):""),i.u.clear(),a.searchFun()}else i.u.fail(t.errmsg);a.active=""}).catch(function(t){a.active="",i.u.fail(t)})},savePromise:function(a){var t=this;return new n.a(function(e,s){t.$axiosPost.post(APIUTL+"?serviceName=svr-financia-management&action=MaterielCode/save",a,{timeout:6e5}).then(function(a){e(a.data)}).catch(function(a){s(a)})})}},mounted:function(){},watch:{},computed:{},created:function(){llApp.init(),this.init()}},h={render:function(){var a=this,t=a.$createElement,e=a._self._c||t;return e("div",{staticClass:"wrap"},[e("div",{staticStyle:{"margin-left":"10px","margin-right":"10px","margin-top":"10px"}},[e("van-nav-bar",{attrs:{title:"物料编码","left-text":a.cname,"right-text":a.search.isml?"面料编码":"辅料编码"}}),a._v(" "),e("van-notice-bar",{attrs:{wrapable:"",scrollable:!1,text:a.saveErr}}),a._v(" "),e("van-popup",{style:{height:"75%"},attrs:{position:"top"},model:{value:a.search.filterModel,callback:function(t){a.$set(a.search,"filterModel",t)},expression:"search.filterModel"}},[e("van-field",{attrs:{name:"switch",label:a.search.isml?"面料":"辅料"},scopedSlots:a._u([{key:"input",fn:function(){return[e("van-switch",{attrs:{size:"20"},on:{click:a.mlswitch},model:{value:a.search.isml,callback:function(t){a.$set(a.search,"isml",t)},expression:"search.isml"}})]},proxy:!0}])}),a._v(" "),e("FieldPickerSingle",{attrs:{title:"开发编号",placeholder:"请选择",inValue:a.search.kfbh,type:"getDevNumList"},on:{"update:inValue":function(t){return a.$set(a.search,"kfbh",t)},"update:in-value":function(t){return a.$set(a.search,"kfbh",t)}}}),a._v(" "),e("van-field",{attrs:{readonly:"",clickable:"",name:"calendar",value:a.search.ksrq,label:"开始日期",placeholder:"点击选择日期"},on:{click:function(t){a.search.showCalendarStar=!0}}}),a._v(" "),e("van-calendar",{attrs:{"min-date":new Date((new Date).getFullYear()-3,0,1)},on:{confirm:a.onCalendarStarConfirm},model:{value:a.search.showCalendarStar,callback:function(t){a.$set(a.search,"showCalendarStar",t)},expression:"search.showCalendarStar"}}),a._v(" "),e("van-field",{attrs:{readonly:"",clickable:"",name:"calendar",value:a.search.jsrq,label:"结束日期",placeholder:"点击选择日期"},on:{click:function(t){a.search.showCalendarEnd=!0}}}),a._v(" "),e("van-calendar",{attrs:{"min-date":new Date((new Date).getFullYear()-3,0,1)},on:{confirm:a.onCalendarEndConfirm},model:{value:a.search.showCalendarEnd,callback:function(t){a.$set(a.search,"showCalendarEnd",t)},expression:"search.showCalendarEnd"}}),a._v(" "),e("van-field",{attrs:{name:"供应商",label:"供应商",placeholder:"供应商"},model:{value:a.search.ghsmc,callback:function(t){a.$set(a.search,"ghsmc",t)},expression:"search.ghsmc"}}),a._v(" "),e("van-field",{attrs:{name:"材料编码",label:"材料编码",placeholder:"材料编码"},model:{value:a.search.chdm,callback:function(t){a.$set(a.search,"chdm",t)},expression:"search.chdm"}}),a._v(" "),e("van-field",{attrs:{name:"材料名称",label:"材料名称",placeholder:"材料名称"},model:{value:a.search.mlbh,callback:function(t){a.$set(a.search,"mlbh",t)},expression:"search.mlbh"}}),a._v(" "),e("FieldPickerSingle",{attrs:{title:"编号状态",placeholder:"请选择",inValue:a.search.myck,dataSource:[{dm:0,mc:"全部"},{dm:1,mc:"已编"},{dm:2,mc:"未编"}]},on:{"update:inValue":function(t){return a.$set(a.search,"myck",t)},"update:in-value":function(t){return a.$set(a.search,"myck",t)}}}),a._v(" "),e("van-field",{attrs:{name:"switch",label:"只限调样已审"},scopedSlots:a._u([{key:"input",fn:function(){return[e("van-switch",{attrs:{size:"20"},model:{value:a.search.shbs,callback:function(t){a.$set(a.search,"shbs",t)},expression:"search.shbs"}})]},proxy:!0}])}),a._v(" "),e("div",{staticStyle:{"text-align":"right","margin-right":"30px"}},[e("van-notice-bar",{attrs:{"left-icon":"volume-o",text:a.errmsg}}),a._v(" "),e("van-button",{attrs:{size:"small",type:"primary"},on:{click:a.searchFun}},[a._v("查询")]),a._v(" "),e("van-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){a.search.filterModel=!1}}},[a._v("关闭")])],1)],1),a._v(" "),a._l(a.mdata.list,function(t,s){return e("div",{key:s,attrs:{name:s}},[e("div",{staticClass:"van-doc-block__card",class:[t.choose?"van-doc-block__card_choose":""]},[e("van-row",[e("van-col",{attrs:{span:"22"}},[a.search.isml?e("van-row",[e("van-col",{attrs:{span:"10"}},[a._v(a._s(t.llyphh))]),a._v(" "),e("van-col",{attrs:{span:"14"}},[a._v(a._s(t.mlbhmc2))])],1):a._e(),a._v(" "),a.search.isml?a._e():e("van-row",[e("van-col",{attrs:{span:"10"}},[a._v(a._s(t.llyphh))]),a._v(" "),e("van-col",{attrs:{span:"14"}},[a._v(a._s(t.mlbh))])],1),a._v(" "),e("van-row",[e("van-col",{attrs:{span:"24"}},[a._v("\n                "+a._s(t.sydw)+"\n              ")])],1),a._v(" "),a.search.isml?e("van-row",[e("van-col",{attrs:{span:"20"}},[a._v("\n                "+a._s(t.cfbl)+"\n              ")]),a._v(" "),e("van-col",{attrs:{span:"4"}},[a._v("\n                "+a._s(t.dw)+"\n              ")])],1):a._e(),a._v(" "),a.search.isml?e("van-row",[e("van-col",{attrs:{span:"6"}},[a._v("\n                "+a._s(t.yplxmc)+"\n              ")]),a._v(" "),e("van-col",{attrs:{span:"12"}},[a._v("\n                "+a._s(t.mllbmc)+"\n              ")]),a._v(" "),e("van-col",{attrs:{span:"6"}},[a._v("\n                "+a._s(t.cwchlbmc)+"\n              ")])],1):a._e(),a._v(" "),a.search.isml?a._e():e("van-row",{attrs:{type:"flex",align:"center"}},[e("van-col",{attrs:{span:"6"}},[a._v("\n                "+a._s(t.dw)+"\n              ")]),a._v(" "),e("van-col",{attrs:{span:"6"}},[a._v("\n                "+a._s(t.yfdw)+"\n              ")]),a._v(" "),e("van-col",{attrs:{span:"12"}},[e("van-field",{attrs:{name:"换算比例",placeholder:"换算比例"},model:{value:t.hsbl,callback:function(e){a.$set(t,"hsbl",e)},expression:"item.hsbl"}})],1)],1),a._v(" "),a.search.isml?a._e():e("van-row",[e("van-col",{attrs:{span:"24"}},[a._v("\n                "+a._s(t.mllbmc)+"\n              ")])],1)],1),a._v(" "),e("van-col",{attrs:{span:"2"}},[e("van-checkbox",{attrs:{disabled:a.search.isml&&""!=t.btx||!a.search.isml&&(t.chdmbs.length>0||0==t.llyphh.length)},model:{value:t.choose,callback:function(e){a.$set(t,"choose",e)},expression:"item.choose"}})],1)],1)],1)])})],2),a._v(" "),e("van-tabbar",{on:{change:a.handleSelect},model:{value:a.active,callback:function(t){a.active=t},expression:"active"}},[e("van-tabbar-item",{attrs:{name:"save",icon:"certificate"}},[a._v("保存")]),a._v(" "),e("van-tabbar-item",{attrs:{name:"choose",icon:"certificate"}},[a._v(a._s(a.allChoose?"取消":"全选"))]),a._v(" "),e("van-tabbar-item",{attrs:{name:"search",icon:"certificate"}},[a._v("查询")])],1)],1)},staticRenderFns:[]};var c=e("VU/8")(r,h,!1,function(a){e("js/c")},"data-v-10737352",null);t.default=c.exports}});
//# sourceMappingURL=7.e012ebea78044302b92c.js.map